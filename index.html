<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inferno Nepean Hockey</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" href="assets/inferno-logo.png" type="image/png">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyCcl7fjelmFRMSNqrNfCTSEJxJcxj7lano",
  databaseURL:"https://infernohockey-b39f9-default-rtdb.firebaseio.com",
  projectId:"infernohockey-b39f9"
};
window.app = initializeApp(firebaseConfig);
window.db = getDatabase(window.app);
</script>

<style>
:root{
  --dark:#0c0c0c;
  --card:#1a1a1a;
  --accent:#ff4500;
  --text:#f2f2f2;
  --highlight:#ff7a3d;
  --danger: #d9534f;
  --success: #28a745;
  --playoff: #ff0000;
}
*{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
body{margin:0;font-family:"Segoe UI", Roboto, sans-serif;background:var(--dark);color:var(--text); line-height: 1.5;}

header{background:linear-gradient(135deg,#8b0000 0%,#ff4500 100%);padding:15px;}
.brand{display:flex;gap:12px;align-items:center;}
.brand img{height:50px;}
.brand h1{font-size: 20px; margin:0;}

nav{display:flex;gap:6px;margin-top:15px;flex-wrap:wrap;}
nav a{color:#fff;text-decoration:none;font-size:12px;font-weight:600;padding:10px 14px;border-radius:6px;background:rgba(0,0,0,0.2);flex-grow:1;text-align:center;cursor:pointer;}

.banner-wrap{background:#000;margin-top:10px;height:40px;display:flex;align-items:center;border-bottom:2px solid var(--accent);overflow:hidden;position:relative;}
.banner-label{background:var(--accent);color:#fff;padding:0 12px;height:100%;display:flex;align-items:center;font-weight:bold;font-size:10px;z-index:2;}
.banner-scroll{white-space:nowrap;position:absolute;animation:scrollText 25s linear infinite;color:#fff;font-size:13px;}
@keyframes scrollText{0%{transform:translateX(100vw);}100%{transform:translateX(-100%);}}

main{max-width:1200px;margin:auto;padding:15px;}
section{display:none;}
section.active{display:block;}

.card{background:var(--card);padding:15px;border-radius:12px;margin-bottom:20px;border:1px solid #222;}
h2{margin-top:0;border-left:4px solid var(--accent);padding-left:12px;text-transform:uppercase;font-size:18px;}

table{width:100%;border-collapse:collapse;margin-top:10px;}
th{background:#111;color:var(--accent);font-size:10px;text-transform: uppercase; padding:10px; border-bottom: 2px solid #222;}
td{padding:12px 10px;text-align:center;border-bottom:1px solid #2a2a2a;font-size:14px;}

/* Admin visibility */
.admin-only { display: none; }
.admin-col { display: none; } /* Hidden by default */

@media (max-width: 768px) {
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { position: absolute; top: -9999px; left: -9999px; }
    tr { border: 1px solid #333; margin-bottom: 10px; border-radius: 8px; background: #111; }
    td { border: none; position: relative; padding-left: 45% !important; text-align: left !important; border-bottom: 1px solid #222; }
    td:before { content: attr(data-label); position: absolute; left: 10px; width: 40%; font-weight: bold; color: var(--accent); text-transform: uppercase; font-size: 10px; }
}

input,textarea,select{width:100%;padding:12px;margin-top:10px;border-radius:6px;border:1px solid #444;background:#000;color:#fff; font-size:16px;}
button{background:var(--accent);color:#fff;border:none;padding:14px;margin-top:12px;cursor:pointer;font-weight:bold;border-radius:6px; width: 100%;}
.btn-sm{width:auto;padding:6px 10px;font-size:12px;margin:2px; display:inline-block;}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="assets/inferno-logo.png">
    <div><h1>Inferno Nepean</h1></div>
  </div>
  <nav>
    <a onclick="show('news')">News</a>
    <a onclick="show('roster')">Roster</a>
    <a onclick="show('schedule')">Schedule</a>
    <a onclick="show('league')">Standings</a>
    <a class="admin" onclick="show('admin')">Admin</a>
    <a id="logoutBtn" style="display:none;color:yellow;" onclick="logout()">Logout</a>
  </nav>
  <div class="banner-wrap">
    <div class="banner-label">UPCOMING</div>
    <div class="banner-scroll" id="bannerText">Loading...</div>
  </div>
</header>

<main>
  <section id="news" class="active">
    <div class="card">
      <h2>Latest News</h2>
      <div id="newsGrid" style="display:grid; gap:15px;"></div>
      <div class="admin-only" style="margin-top:20px; padding:15px; background:#222; border-radius:8px;">
        <h3>Post News</h3>
        <input id="newsTitle" placeholder="Title">
        <textarea id="newsContent" placeholder="Content"></textarea>
        <button onclick="saveNews()">Publish</button>
      </div>
    </div>
  </section>

  <section id="roster">
    <div class="card">
      <h2>Forwards</h2>
      <table>
        <thead><tr><th>Name</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-col">Edit</th></tr></thead>
        <tbody id="roster-forward"></tbody>
      </table>
      <h3>Defense</h3>
      <table>
        <thead><tr><th>Name</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-col">Edit</th></tr></thead>
        <tbody id="roster-defense"></tbody>
      </table>
      <h3>Goalies</h3>
      <table>
        <thead><tr><th>Name</th><th>#</th><th>W-L-T</th><th>GAA</th><th>SV%</th><th class="admin-col">Edit</th></tr></thead>
        <tbody id="roster-goalie"></tbody>
      </table>
      
      <div class="admin-only" style="margin-top:20px; padding:15px; background:#222; border-radius:8px;">
        <h3>Add Player</h3>
        <input id="pName" placeholder="Name">
        <input id="pNum" placeholder="Number">
        <select id="pPos" onchange="toggleStatPlaceholder()"><option value="forward">Forward</option><option value="defense">Defense</option><option value="goalie">Goalie</option></select>
        <input id="pStats" placeholder="G | A | P">
        <button onclick="addPlayer()">Add Player</button>
      </div>
    </div>
    <div class="card">
        <h2>Coaching Staff</h2>
        <table><thead><tr><th>Name</th><th>Role</th><th>Focus</th><th class="admin-col">Edit</th></tr></thead><tbody id="coachBody"></tbody></table>
        <div class="admin-only" style="margin-top:20px; padding:15px; background:#222; border-radius:8px;">
            <input id="cName" placeholder="Name"><input id="cRole" placeholder="Role"><input id="cBio" placeholder="Bio"><button onclick="saveCoach()">Add Coach</button>
        </div>
    </div>
  </section>

  <section id="schedule">
    <div class="card">
      <h2>Schedule</h2>
      <table>
        <thead><tr><th>Type</th><th>Date</th><th>Opponent</th><th>Location</th><th>Result</th><th class="admin-col">Edit</th></tr></thead>
        <tbody id="scheduleBody"></tbody>
      </table>
      <div class="admin-only" style="margin-top:20px; padding:15px; background:#222; border-radius:8px;">
        <select id="eventType"><option>Game</option><option>Playoff Game</option><option>Tournament</option><option>Practice</option></select>
        <input id="eventDate" placeholder="Date"><input id="eventDetail" placeholder="Opponent"><input id="eventLoc" placeholder="Rink"><input id="eventResult" placeholder="Score">
        <label><input type="checkbox" id="eventBannerToggle" style="width:auto"> Show on Banner</label>
        <button onclick="addEvent()">Add Event</button>
      </div>
    </div>
  </section>

  <section id="league">
    <div class="card">
      <h2>League</h2>
      <table><thead><tr><th>Team</th><th>GP</th><th>PTS</th><th>W-L-T</th><th>GF-GA</th><th class="admin-col">Edit</th></tr></thead><tbody id="leagueBody"></tbody></table>
      <div class="admin-only"><input id="leagueInput" placeholder="Data..."><button onclick="saveGeneric('league', 'leagueInput')">Add Team</button></div>
    </div>
  </section>

  <section id="admin">
    <div class="card">
      <h2>Admin Login</h2>
      <input id="user" placeholder="Username"><input id="pass" type="password" placeholder="Password"><button onclick="login()">Login</button>
    </div>
  </section>
</main>

<script type="module">
import { ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
const db = window.db;
let isAdmin = false;

window.show = id => {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

window.login = () => {
  if(user.value === "athenadmin" && pass.value === "AthFon32") {
    isAdmin = true;
    document.querySelectorAll(".admin-only, .admin-col").forEach(e => e.style.display = isAdmin ? "block" : "none");
    if(isAdmin) document.querySelectorAll(".admin-col").forEach(e => e.style.display = "table-cell");
    document.getElementById('logoutBtn').style.display = "inline-block";
    renderAll();
    show('news');
  } else { alert("Login Failed"); }
};

window.logout = () => { isAdmin = false; location.reload(); };

// --- RENDERING ---
function renderRoster() {
  onValue(ref(db, "roster"), snap => {
    ["forward", "defense", "goalie"].forEach(p => document.getElementById(`roster-${p}`).innerHTML = "");
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const p = data[id].split("|").map(x => x.trim());
      const tr = document.createElement("tr");
      const labels = p[2] === 'goalie' ? ["Name","#","W-L-T","GAA","SV%"] : ["Name","#","G","A","P"];
      tr.innerHTML = `<td data-label="${labels[0]}">${p[0]}</td><td data-label="${labels[1]}">${p[1]}</td><td data-label="${labels[2]}">${p[3]}</td><td data-label="${labels[3]}">${p[4]}</td><td data-label="${labels[4]}">${p[5]}</td>`;
      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initEdit('roster','${id}','${data[id]}')">Edit</button><button class="btn-sm" style="background:red" onclick="deleteItem('roster','${id}')">X</button>`;
        tr.appendChild(td);
      }
      document.getElementById(`roster-${p[2]}`).appendChild(tr);
    });
  });
}

function renderSchedule() {
  onValue(ref(db, "schedule"), snap => {
    const body = document.getElementById("scheduleBody"); body.innerHTML = "";
    const banner = document.getElementById("bannerText"); let bannerItems = [];
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const p = data[id].split("|").map(x => x.trim());
      const isBanner = p[5] === "true";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td data-label="Type">${p[0]}</td><td data-label="Date">${p[1]}</td><td data-label="Opponent">${p[2]}</td><td data-label="Location">${p[3]}</td><td data-label="Result">${p[4] || '-'}</td>`;
      if(isBanner && !p[4]) bannerItems.push(`${p[0]}: ${p[1]} vs ${p[2]}`);
      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initEdit('schedule','${id}','${data[id]}')">Edit</button>`;
        tr.appendChild(td);
      }
      body.appendChild(tr);
    });
    banner.innerText = bannerItems.join(" | ") || "No featured events.";
  });
}

function renderTable(key, bodyId, labels) {
  onValue(ref(db, key), snap => {
    const body = document.getElementById(bodyId); if(!body) return; body.innerHTML = "";
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const p = data[id].split("|").map(x => x.trim());
      const tr = document.createElement("tr");
      tr.innerHTML = p.map((v, i) => `<td data-label="${labels[i]}">${v}</td>`).join("");
      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initEdit('${key}','${id}','${data[id]}')">Edit</button>`;
        tr.appendChild(td);
      }
      body.appendChild(tr);
    });
  });
}

window.initEdit = (key, id, val) => {
    const newVal = prompt("Edit data (use | to separate values):", val);
    if(newVal) set(ref(db, `${key}/${id}`), newVal);
};

window.deleteItem = (key, id) => { if(confirm("Delete?")) remove(ref(db, `${key}/${id}`)); };

// --- BUTTON ACTIONS ---
window.addEvent = () => {
    const b = eventBannerToggle.checked ? "true" : "false";
    set(ref(db, "schedule/"+Date.now()), `${eventType.value}|${eventDate.value}|${eventDetail.value}|${eventLoc.value}|${eventResult.value}|${b}`);
};
window.addPlayer = () => set(ref(db, "roster/"+Date.now()), `${pName.value}|${pNum.value}|${pPos.value}|${pStats.value}`);
window.saveCoach = () => set(ref(db, "coaches/"+Date.now()), `${cName.value}|${cRole.value}|${cBio.value}`);
window.saveNews = () => set(ref(db, "news/"+Date.now()), `${newsTitle.value}|${newsContent.value}`);
window.saveGeneric = (key, inputId) => { set(ref(db, key+"/"+Date.now()), document.getElementById(inputId).value); };

function renderAll() {
  renderRoster(); renderSchedule();
  renderTable("coaches", "coachBody", ["Name","Role","Bio"]);
  renderTable("league", "leagueBody", ["Team","GP","PTS","W-L-T","GF-GA"]);
  onValue(ref(db, "news"), snap => {
    newsGrid.innerHTML = ""; const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const p = data[id].split("|");
      newsGrid.innerHTML += `<div class="card"><h3>${p[0]}</h3><p>${p[1]}</p>${isAdmin ? `<button class="btn-sm" onclick="deleteItem('news','${id}')">Delete</button>` : ''}</div>`;
    });
  });
}
renderAll();
</script>
</body>
</html>
