<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inferno Nepean Hockey</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="assets/inferno-logo.png" type="image/png">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyCcl7fjelmFRMSNqrNfCTSEJxJcxj7lano",
  databaseURL:"https://infernohockey-b39f9-default-rtdb.firebaseio.com",
  projectId:"infernohockey-b39f9"
};
window.app = initializeApp(firebaseConfig);
window.db = getDatabase(window.app);
</script>

<style>
:root{
  --dark:#0c0c0c;
  --card:#1a1a1a;
  --accent:#ff4500;
  --text:#f2f2f2;
  --highlight:#ff7a3d;
  --danger: #d9534f;
  --success: #28a745;
}
*{box-sizing:border-box;}
body{margin:0;font-family:"Segoe UI",sans-serif;background:var(--dark);color:var(--text);}

header{background:linear-gradient(135deg,#8b0000 0%,#ff4500 100%);padding:20px;}
.brand{display:flex;gap:15px;align-items:center;}
.brand img{height:60px;}
nav{display:flex;gap:8px;margin-top:15px;flex-wrap:wrap;}
nav a{color:#fff;text-decoration:none;font-size:13px;font-weight:600;padding:8px 12px;border-radius:4px;cursor:pointer;background:rgba(0,0,0,0.2);}
nav a:hover{background:rgba(255,255,255,0.3);}

.banner-wrap{background:#000;margin-top:15px;height:35px;display:flex;align-items:center;border:1px solid #333;overflow:hidden;position:relative;}
.banner-label{background:var(--accent);color:#fff;padding:0 15px;height:100%;display:flex;align-items:center;font-weight:bold;font-size:11px;z-index:2;}
.banner-scroll{white-space:nowrap;position:absolute;animation:scrollText 30s linear infinite;color:#fff; display: flex; align-items: center;}
@keyframes scrollText{0%{transform:translateX(100vw);}100%{transform:translateX(-100%);}}

main{max-width:1400px;margin:auto;padding:20px;}
section{display:none;}
section.active{display:block;}
.card{background:var(--card);padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #222; overflow-x: auto;}
h2{margin-top:0;border-left:5px solid var(--accent);padding-left:15px;text-transform:uppercase;font-size:20px;}

table{width:100%;border-collapse:collapse;margin-top:10px; min-width: 1000px;}
th,td{padding:10px;text-align:center;border-bottom:1px solid #2a2a2a;font-size:13px;}
th{background:#111;color:var(--accent);font-size:11px;text-transform: uppercase;}

.admin-only{display:none;}
.admin-input-group{background:#222; padding:15px; border-radius:8px; margin-top:20px;}
input,textarea,select{width:100%;padding:10px;margin-top:8px;border-radius:4px;border:1px solid #333;background:#050505;color:#fff;}
.inline-check{width:auto; vertical-align: middle; margin-right: 5px;}
button{background:var(--accent);color:#fff;border:none;padding:10px;margin-top:10px;cursor:pointer;font-weight:bold;border-radius:4px;}
.btn-sm{width:auto;padding:4px 8px;font-size:11px;margin:2px;}

/* Special Edit Overlay for Schedule */
.edit-box { background: #333; padding: 10px; border-radius: 8px; border: 1px solid var(--accent); margin: 10px 0; }
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="assets/inferno-logo.png">
    <div><h1>Inferno Nepean</h1><span>LOYALTY ‚Ä¢ TRUST ‚Ä¢ COMMITMENT</span></div>
  </div>
  <nav>
    <a onclick="show('news')">News</a>
    <a onclick="show('roster')">Roster</a>
    <a onclick="show('league')">Standings</a>
    <a onclick="show('schedule')">Schedule</a>
    <a onclick="show('record')">Record</a>
    <a class="admin" onclick="show('admin')">Admin</a>
    <a id="logoutBtn" style="display:none;color:yellow;" onclick="logout()">Logout</a>
  </nav>
  <div class="banner-wrap">
    <div class="banner-label">UPCOMING</div>
    <div class="banner-scroll" id="bannerText">Checking schedule...</div>
  </div>
</header>

<main>
  <section id="schedule">
    <div class="card">
      <h2>Team Schedule & Events</h2>
      <table>
        <thead>
          <tr><th>Type</th><th>Date</th><th>Details</th><th>Location</th><th>Result/Score</th><th>Banner Status</th><th class="admin-only">Actions</th></tr>
        </thead>
        <tbody id="scheduleBody"></tbody>
      </table>

      <div class="admin-only admin-input-group">
        <h3>Add New Event (Prep Mode)</h3>
        <select id="eventType">
          <option value="Game">Game</option>
          <option value="Tournament">Tournament</option>
          <option value="Practice">Practice</option>
        </select>
        <input id="eventDate" placeholder="Date/Time">
        <input id="eventDetail" placeholder="Opponent or Name">
        <input id="eventLoc" placeholder="Location">
        <input id="eventResult" placeholder="Result (Leave empty for upcoming)">
        <div style="margin-top:10px;">
            <label><input type="checkbox" id="eventBannerToggle" class="inline-check"> <strong>Show on Banner immediately?</strong></label>
        </div>
        <button onclick="addEvent()">Add Event</button>
      </div>
    </div>
  </section>

  <section id="news" class="active">
    <div class="card">
      <h2>Team News</h2>
      <div id="newsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px;"></div>
      <div class="admin-only admin-input-group">
        <h3>Post News</h3>
        <input id="newsTitle" placeholder="Title">
        <textarea id="newsContent" placeholder="Content"></textarea>
        <button onclick="saveNews()">Publish News</button>
      </div>
    </div>
  </section>

  <section id="roster">
    <div class="card">
      <h2>Player Roster</h2>
      <h3>Forwards</h3>
      <table><thead><tr><th>Name</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-only">Actions</th></tr></thead><tbody id="roster-forward"></tbody></table>
      <h3>Defense</h3>
      <table><thead><tr><th>Name</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-only">Actions</th></tr></thead><tbody id="roster-defense"></tbody></table>
      <h3>Goalies</h3>
      <table><thead><tr><th>Name</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-only">Actions</th></tr></thead><tbody id="roster-goalie"></tbody></table>
      <div class="admin-only admin-input-group">
        <input id="pName" placeholder="Name">
        <input id="pNum" placeholder="Number">
        <select id="pPos">
            <option value="forward">Forward</option>
            <option value="defense">Defense</option>
            <option value="goalie">Goalie</option>
        </select>
        <input id="pStats" placeholder="G | A | P">
        <button onclick="addPlayer()">Add Player</button>
      </div>
    </div>
  </section>

  <section id="league">
    <div class="card">
      <h2>League Standings</h2>
      <table>
        <thead>
          <tr><th>Team</th><th>GP</th><th>W</th><th>L</th><th>T</th><th>PTS</th><th>GF</th><th>GA</th><th>PIM</th><th>Face %</th><th>Shots</th><th>L10</th><th>Strk</th><th>Last Game</th><th class="admin-only">Actions</th></tr>
        </thead>
        <tbody id="leagueBody"></tbody>
      </table>
      <div class="admin-only admin-input-group">
        <input id="leagueInput" placeholder="Team | GP | W | L | T | PTS | GF | GA | PIM | Face% | Shots | L10 | Strk | Last Game">
        <button onclick="saveGeneric('league', 'leagueInput')">Add Team</button>
      </div>
    </div>
  </section>

  <section id="record">
    <div class="card">
        <h2>Season Record</h2>
        <div style="text-align:center; font-size:40px; font-weight:900; color:var(--accent);" id="recordDisplay">0-0-0</div>
        <table>
          <thead><tr><th>Phase</th><th>W-L-T</th><th class="admin-only">Actions</th></tr></thead>
          <tbody id="recordBody"></tbody>
        </table>
        <div class="admin-only admin-input-group">
          <input id="recordInput" placeholder="Season Phase | W-L-T">
          <button onclick="saveGeneric('record', 'recordInput')">Update Record</button>
        </div>
      </div>
  </section>

  <section id="admin">
    <div class="card">
      <h2>Admin Login</h2>
      <input id="user" placeholder="Username">
      <input id="pass" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>
  </section>
</main>

<script type="module">
import { ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
const db = window.db;
let isAdmin = false;

window.show = id => {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

window.login = () => {
  if(user.value === "athenadmin" && pass.value === "AthFon32") {
    isAdmin = true;
    document.querySelectorAll(".admin-only").forEach(e => e.style.display = "block");
    document.getElementById('logoutBtn').style.display = "inline-block";
    renderAll();
    alert("Admin Access Granted");
  } else { alert("Access Denied"); }
};

window.logout = () => { isAdmin = false; location.reload(); };

// --- RENDERING ---

function renderSchedule() {
  onValue(ref(db, "schedule"), snap => {
    const body = document.getElementById("scheduleBody");
    body.innerHTML = "";
    const banner = document.getElementById("bannerText");
    let bannerItems = [];
    const data = snap.val() || {};

    Object.keys(data).forEach(id => {
      const parts = data[id].split("|").map(p => p.trim());
      const type = parts[0];
      const showOnBanner = parts[5] === "true";
      const isUpcoming = !parts[4] || parts[4].toLowerCase() === "tbd";

      const tr = document.createElement("tr");
      tr.id = `schedule-${id}`;
      let rowHtml = "";
      for(let i=0; i<5; i++) rowHtml += `<td>${parts[i]}</td>`;
      rowHtml += `<td style="color:${showOnBanner ? 'lime':'#555'}">${showOnBanner ? 'ON BANNER' : 'HIDDEN'}</td>`;
      tr.innerHTML = rowHtml;

      if(isUpcoming && showOnBanner) {
          let icon = type === "Tournament" ? "üèÜ" : "üèí";
          bannerItems.push(`${icon} ${type.toUpperCase()}: ${parts[1]} - ${parts[2]} (${parts[3]})`);
      }

      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initScheduleEdit('${id}','${data[id]}')">Edit/Toggle</button>
                        <button class="btn-sm" style="background:red" onclick="deleteItem('schedule','${id}')">X</button>`;
        tr.appendChild(td);
      }
      body.appendChild(tr);
    });
    banner.innerText = bannerItems.join(" | ") || "No upcoming featured events.";
  });
}

// Special Edit Handler for Schedule
window.initScheduleEdit = (id, val) => {
    const p = val.split("|").map(x => x.trim());
    const tr = document.getElementById(`schedule-${id}`);
    tr.innerHTML = `
      <td colspan="100%">
        <div class="edit-box">
          <select id="edType-${id}"><option ${p[0]=='Game'?'selected':''}>Game</option><option ${p[0]=='Tournament'?'selected':''}>Tournament</option><option ${p[0]=='Practice'?'selected':''}>Practice</option></select>
          <input id="edDate-${id}" value="${p[1]}" placeholder="Date">
          <input id="edDet-${id}" value="${p[2]}" placeholder="Details">
          <input id="edLoc-${id}" value="${p[3]}" placeholder="Location">
          <input id="edRes-${id}" value="${p[4]}" placeholder="Result">
          <label><input type="checkbox" id="edBan-${id}" ${p[5]=='true'?'checked':''}> Show on Banner</label><br>
          <button class="btn-sm" style="background:green" onclick="saveScheduleEdit('${id}')">Save Changes</button>
          <button class="btn-sm" onclick="renderSchedule()">Cancel</button>
        </div>
      </td>`;
};

window.saveScheduleEdit = (id) => {
    const banner = document.getElementById(`edBan-${id}`).checked ? "true" : "false";
    const str = `${document.getElementById(`edType-${id}`).value}|${document.getElementById(`edDate-${id}`).value}|${document.getElementById(`edDet-${id}`).value}|${document.getElementById(`edLoc-${id}`).value}|${document.getElementById(`edRes-${id}`).value}|${banner}`;
    set(ref(db, "schedule/"+id), str);
};

// --- GENERAL RENDERING ---

function renderTable(key, bodyId) {
  onValue(ref(db, key), snap => {
    const body = document.getElementById(bodyId);
    if(!body) return;
    body.innerHTML = "";
    const data = snap.val() || {};
    let keys = Object.keys(data);
    if(key === "league") keys.sort((a, b) => (parseInt(data[b].split("|")[5]) || 0) - (parseInt(data[a].split("|")[5]) || 0));
    keys.forEach(id => {
      const parts = data[id].split("|").map(p => p.trim());
      const tr = document.createElement("tr");
      tr.id = `${key}-${id}`;
      tr.innerHTML = parts.map(p => `<td>${p}</td>`).join("");
      if(key === 'record') document.getElementById('recordDisplay').innerText = parts[1];
      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initEdit('${key}','${id}','${data[id]}')">Edit</button>
                        <button class="btn-sm" style="background:red" onclick="deleteItem('${key}','${id}')">X</button>`;
        tr.appendChild(td);
      }
      body.appendChild(tr);
    });
  });
}

function renderRoster() {
  onValue(ref(db, "roster"), snap => {
    ["forward", "defense", "goalie"].forEach(pos => document.getElementById(`roster-${pos}`).innerHTML = "");
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const p = data[id].split("|").map(x => x.trim()); 
      const tr = document.createElement("tr");
      tr.id = `roster-${id}`;
      tr.innerHTML = `<td>${p[0]}</td><td>${p[1]}</td><td>${p[3]}</td><td>${p[4]}</td><td>${p[5]}</td>`;
      if(isAdmin) {
        const td = document.createElement("td");
        td.innerHTML = `<button class="btn-sm" onclick="initEdit('roster','${id}','${data[id]}')">Edit</button>
                        <button class="btn-sm" style="background:red" onclick="deleteItem('roster','${id}')">X</button>`;
        tr.appendChild(td);
      }
      const target = document.getElementById(`roster-${p[2]}`);
      if(target) target.appendChild(tr);
    });
  });
}

function renderNews() {
  onValue(ref(db, "news"), snap => {
    const grid = document.getElementById("newsGrid");
    grid.innerHTML = "";
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const parts = data[id].split("|");
      const div = document.createElement("div");
      div.style = "background:#222; padding:15px; border-radius:8px; border-top:3px solid var(--accent);";
      div.id = `news-${id}`;
      div.innerHTML = `<h4>${parts[0]}</h4><p>${parts[1]}</p>`;
      if(isAdmin) div.innerHTML += `<button class="btn-sm" onclick="initEdit('news','${id}','${data[id]}')">Edit</button>
                                    <button class="btn-sm" style="background:red" onclick="deleteItem('news','${id}')">X</button>`;
      grid.appendChild(div);
    });
  });
}

// --- ACTIONS ---
window.addEvent = () => {
    const bannerVal = document.getElementById("eventBannerToggle").checked ? "true" : "false";
    const eventString = `${eventType.value}|${eventDate.value}|${eventDetail.value}|${eventLoc.value}|${eventResult.value}|${bannerVal}`;
    set(ref(db, "schedule/" + Date.now()), eventString);
    eventDate.value=""; eventDetail.value=""; eventLoc.value=""; eventResult.value="";
    document.getElementById("eventBannerToggle").checked = false;
};

window.saveGeneric = (key, inputId) => {
    set(ref(db, key + "/" + Date.now()), document.getElementById(inputId).value);
    document.getElementById(inputId).value = "";
};

window.addPlayer = () => {
    set(ref(db, "roster/" + Date.now()), `${pName.value}|${pNum.value}|${pPos.value}|${pStats.value}`);
    pName.value=""; pNum.value=""; pStats.value="";
};

window.saveNews = () => {
    set(ref(db, "news/" + Date.now()), `${newsTitle.value}|${newsContent.value}`);
    newsTitle.value=""; newsContent.value="";
};

window.deleteItem = (key, id) => { if(confirm("Delete?")) remove(ref(db, key+"/"+id)); };

window.initEdit = (key, id, currentVal) => {
    const tr = document.getElementById(`${key}-${id}`) || document.getElementById(`news-${id}`);
    tr.innerHTML = `<td colspan="100%"><input id="edit-${id}" style="width:80%" value="${currentVal}">
                    <button class="btn-sm" style="background:green" onclick="finishEdit('${key}','${id}')">Save</button>
                    <button class="btn-sm" onclick="renderAll()">Cancel</button></td>`;
};

window.finishEdit = (key, id) => set(ref(db, key+"/"+id), document.getElementById(`edit-${id}`).value);

function renderAll() {
  renderNews(); renderRoster(); renderSchedule();
  renderTable("league", "leagueBody"); renderTable("record", "recordBody");
}
renderAll();
</script>
</body>
</html>
